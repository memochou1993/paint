var m=Object.defineProperty;var w=(a,s,t)=>s in a?m(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t;var h=(a,s,t)=>(w(a,typeof s!="symbol"?s+"":s,t),t);const O=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}};O();class y{constructor(){h(this,"canvas");h(this,"ctx");h(this,"shapes",[]);h(this,"selectedShapes",[]);h(this,"groups",[]);h(this,"onMouseDown",()=>{});h(this,"onMouseMove",()=>{});h(this,"onMouseUp",()=>{});h(this,"onMouseOut",()=>{});this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.init()}init(){this.canvas.addEventListener("mousedown",s=>{s.preventDefault(),this.onMouseDown(s)}),this.canvas.addEventListener("mousemove",s=>{s.preventDefault(),this.onMouseMove(s)}),this.canvas.addEventListener("mouseup",s=>{s.preventDefault(),this.onMouseUp(s)}),this.canvas.addEventListener("mouseout",s=>{s.preventDefault(),this.onMouseOut(s)})}redraw(){this.shapes.forEach(s=>s.draw())}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}resize(){this.canvas.height=window.innerHeight-document.getElementById("header").clientHeight,this.canvas.width=window.innerWidth-document.getElementById("sidebar").clientWidth}}var o=(a=>(a.Cursor="cursor",a.Ellipse="ellipse",a.Rectangle="rectangle",a))(o||{});class d{constructor(s){h(this,"canvas");this.canvas=s}}const u=Object.freeze({FILL_COLOR:"steelblue",HEIGHT:10,WIDTH:10}),l=Object.freeze({LINE_WIDTH:2,STROKE_COLOR:"steelblue"}),c=Object.freeze({LINE_WIDTH:2,FILL_COLOR:"aliceblue",STROKE_COLOR:"steelblue"});class S extends d{constructor(){super(...arguments);h(this,"element",document.getElementById(o.Cursor));h(this,"cursor","default");h(this,"isDrawing",!1)}mouseDown(t){if(this.isDrawing=!0,this.canvas.clear(),this.canvas.redraw(),!this.selectGroup(t)&&!this.selectShape(t)){this.canvas.selectedShapes=[],this.isDrawing=!1;return}this.canvas.selectedShapes.forEach(e=>{e.offset(t.offsetX-e.x,t.offsetY-e.y),e.select()}),this.drawGroupOutline()}mouseMove(t){document.body.style.cursor=this.canvas.shapes.some(e=>e.contains(t.offsetX,t.offsetY))?"move":this.cursor,this.isDrawing&&(this.canvas.selectedShapes.forEach(e=>e.move(t.offsetX,t.offsetY)),this.canvas.clear(),this.canvas.redraw(),this.canvas.selectedShapes.forEach(e=>e.select()),this.drawGroupOutline())}mouseUp(){this.isDrawing=!1}mouseOut(){this.mouseUp()}selectGroup(t){const e=[...this.canvas.groups].reverse().find(i=>i.some(n=>n.contains(t.offsetX,t.offsetY)));return e?(this.canvas.selectedShapes=e,!0):!1}selectShape(t){const e=[...this.canvas.shapes].reverse().findIndex(n=>n.contains(t.offsetX,t.offsetY));if(e<0)return!1;const i=this.canvas.shapes[this.canvas.shapes.length-e-1];return t.shiftKey?this.canvas.selectedShapes.includes(i)?(this.canvas.selectedShapes=this.canvas.selectedShapes.filter(n=>n!==i),!0):(this.canvas.selectedShapes.push(i),!0):(this.canvas.selectedShapes=[i],!0)}drawGroupOutline(){if(this.canvas.selectedShapes.length<2)return;this.canvas.ctx.strokeStyle=l.STROKE_COLOR;const t=Math.min(...this.canvas.selectedShapes.map(r=>r.minX)),e=Math.min(...this.canvas.selectedShapes.map(r=>r.minY)),i=Math.max(...this.canvas.selectedShapes.map(r=>r.maxX)),n=Math.max(...this.canvas.selectedShapes.map(r=>r.maxY));this.canvas.ctx.strokeRect(t,e,i-t,n-e),this.canvas.ctx.strokeStyle=c.STROKE_COLOR}}class p{constructor(s,t,e){h(this,"ctx");h(this,"x");h(this,"y");h(this,"offsetX",0);h(this,"offsetY",0);this.ctx=s,this.x=t,this.y=e}setX(s){this.x=s}setY(s){this.y=s}offset(s,t){this.offsetX=s,this.offsetY=t}move(s,t){this.setX(s-this.offsetX),this.setY(t-this.offsetY)}}class L extends p{constructor(t,e=0,i=0,n=0,r=0){super(t,e,i);h(this,"width");h(this,"height");this.width=n,this.height=r}setWidth(t){this.width=t}setHeight(t){this.height=t}get minX(){return this.width>0?this.x:this.x+this.width}get minY(){return this.height>0?this.y:this.y+this.height}get maxX(){return this.width>0?this.x+this.width:this.x}get maxY(){return this.height>0?this.y+this.height:this.y}draw(){this.ctx.lineWidth=c.LINE_WIDTH,this.ctx.fillStyle=c.FILL_COLOR,this.ctx.strokeStyle=c.STROKE_COLOR,this.ctx.fillRect(this.x,this.y,this.width,this.height),this.ctx.strokeRect(this.x,this.y,this.width,this.height)}select(){this.drawAnchor(),this.drawOutline()}contains(t,e){const i=new Path2D;return i.rect(this.x,this.y,this.width,this.height),this.ctx.isPointInPath(i,t,e)}isShapeless(){return this.width*this.height===0}drawAnchor(){this.ctx.fillStyle=u.FILL_COLOR;const{HEIGHT:t,WIDTH:e}=u;this.ctx.beginPath(),this.ctx.rect(this.x+this.width/2-e/2,this.y-t/2,e,t),this.ctx.rect(this.x+this.width/2-e/2,this.y+this.height-t/2,e,t),this.ctx.rect(this.x-e/2,this.y+this.height/2-t/2,e,t),this.ctx.rect(this.x+this.width-e/2,this.y+this.height/2-t/2,e,t),this.ctx.fill(),this.ctx.fillStyle=c.FILL_COLOR}drawOutline(){this.ctx.lineWidth=l.LINE_WIDTH,this.ctx.strokeStyle=l.STROKE_COLOR,this.ctx.strokeRect(this.x,this.y,this.width,this.height),this.ctx.strokeStyle=c.STROKE_COLOR,this.ctx.lineWidth=c.LINE_WIDTH}}class E extends p{constructor(t,e=0,i=0,n=0,r=0,v=Math.PI,g=0,x=Math.PI*2){super(t,e,i);h(this,"radiusX");h(this,"radiusY");h(this,"rotation");h(this,"startAngle");h(this,"endAngle");this.radiusX=n,this.radiusY=r,this.rotation=v,this.startAngle=g,this.endAngle=x}setRadiusX(t){this.radiusX=t}setRadiusY(t){this.radiusY=t}draw(){this.ctx.lineWidth=c.LINE_WIDTH,this.ctx.fillStyle=c.FILL_COLOR,this.ctx.strokeStyle=c.STROKE_COLOR,this.ctx.beginPath(),this.ctx.ellipse(this.x,this.y,this.radiusX,this.radiusY,this.rotation,this.startAngle,this.endAngle),this.ctx.fill(),this.ctx.stroke()}select(){this.drawAnchor(),this.drawOutline()}contains(t,e){const i=new Path2D;return i.ellipse(this.x,this.y,this.radiusX,this.radiusY,this.rotation,this.startAngle,this.endAngle),this.ctx.isPointInPath(i,t,e)}isShapeless(){return this.radiusX*this.radiusY===0}get minX(){return this.x-this.radiusX}get minY(){return this.y-this.radiusY}get maxX(){return this.x+this.radiusX}get maxY(){return this.y+this.radiusY}drawAnchor(){this.ctx.fillStyle=u.FILL_COLOR;const{HEIGHT:t,WIDTH:e}=u;this.ctx.beginPath(),this.ctx.rect(this.x-e/2,this.y-this.radiusY-t/2,e,t),this.ctx.rect(this.x-e/2,this.y+this.radiusY-t/2,e,t),this.ctx.rect(this.x-this.radiusX-e/2,this.y-t/2,e,t),this.ctx.rect(this.x+this.radiusX-e/2,this.y-t/2,e,t),this.ctx.fill(),this.ctx.fillStyle=c.FILL_COLOR}drawOutline(){this.ctx.lineWidth=l.LINE_WIDTH,this.ctx.strokeStyle=l.STROKE_COLOR,this.ctx.beginPath(),this.ctx.ellipse(this.x,this.y,this.radiusX,this.radiusY,this.rotation,this.startAngle,this.endAngle),this.ctx.stroke(),this.ctx.strokeStyle=c.STROKE_COLOR,this.ctx.lineWidth=c.LINE_WIDTH}}class I extends d{constructor(){super(...arguments);h(this,"element",document.getElementById(o.Rectangle));h(this,"cursor","crosshair");h(this,"shape",null)}mouseDown(t){this.shape=new L(this.canvas.ctx),this.shape.setX(t.offsetX),this.shape.setY(t.offsetY)}mouseMove(t){!this.shape||(this.canvas.clear(),this.canvas.redraw(),this.shape.setWidth(t.offsetX-this.shape.x),this.shape.setHeight(t.offsetY-this.shape.y),this.shape.draw())}mouseUp(){!this.shape||(this.shape.isShapeless()||this.canvas.shapes.push(this.shape),this.shape=null)}mouseOut(){this.mouseUp()}}class R extends d{constructor(){super(...arguments);h(this,"element",document.getElementById(o.Ellipse));h(this,"cursor","crosshair");h(this,"shape",null);h(this,"startX",0);h(this,"startY",0)}mouseDown(t){this.shape=new E(this.canvas.ctx),this.startX=t.offsetX,this.startY=t.offsetY}mouseMove(t){if(!this.shape)return;this.canvas.clear(),this.canvas.redraw();const e=(t.offsetX-this.startX)/2,i=(t.offsetY-this.startY)/2;this.shape.setX(this.startX+e),this.shape.setY(this.startY+i),this.shape.setRadiusX(Math.abs(e)*Math.sqrt(2)),this.shape.setRadiusY(Math.abs(i)*Math.sqrt(2)),this.shape.draw()}mouseUp(){!this.shape||(this.shape.isShapeless()||this.canvas.shapes.push(this.shape),this.shape=null)}mouseOut(){this.mouseUp()}}class X{static create(s,t){switch(s){case o.Cursor:return new S(t);case o.Rectangle:return new I(t);case o.Ellipse:return new R(t);default:return null}}}class f{constructor(s){h(this,"canvas");var t;this.canvas=s,(t=document.getElementById(this.id()))==null||t.addEventListener("click",e=>this.onClick(e))}}class Y extends f{id(){return"group"}onClick(){this.canvas.selectedShapes.length<2||this.canvas.groups.some(s=>s===this.canvas.selectedShapes)||this.canvas.groups.push(this.canvas.selectedShapes)}}class C extends f{id(){return"ungroup"}onClick(){this.canvas.selectedShapes.length<2||(this.canvas.groups=this.canvas.groups.filter(s=>s!==this.canvas.selectedShapes))}}class M extends f{id(){return"delete"}onClick(){this.canvas.selectedShapes.length<1||(this.canvas.groups=this.canvas.groups.filter(s=>s!==this.canvas.selectedShapes),this.canvas.shapes=this.canvas.shapes.filter(s=>!this.canvas.selectedShapes.some(t=>t===s)),this.canvas.clear(),this.canvas.redraw())}}class W{constructor(){h(this,"canvas",new y);h(this,"widget",null);this.initWindow(),this.initTools(),this.initWidgets(),this.initCanvas()}initWindow(){window.addEventListener("resize",()=>this.resizeCanvas())}initTools(){new Y(this.canvas),new C(this.canvas),new M(this.canvas)}initWidgets(){const s=document.getElementsByClassName("widget");Array.from(s).forEach(t=>{const e=X.create(t.id,this.canvas);t.addEventListener("click",()=>this.useWidget(e))})}initCanvas(){this.canvas.resize(),this.canvas.onMouseDown=s=>{var t;return(t=this.widget)==null?void 0:t.mouseDown(s)},this.canvas.onMouseMove=s=>{var t;return(t=this.widget)==null?void 0:t.mouseMove(s)},this.canvas.onMouseUp=s=>{var t;return(t=this.widget)==null?void 0:t.mouseUp(s)},this.canvas.onMouseOut=s=>{var t;return(t=this.widget)==null?void 0:t.mouseOut(s)}}useWidget(s){var t;(t=this.widget)==null||t.element.classList.remove("selected"),this.widget=s,this.widget.element.classList.add("selected"),document.body.style.cursor=this.widget.cursor}resizeCanvas(){this.canvas.resize(),this.canvas.redraw()}}new W;
